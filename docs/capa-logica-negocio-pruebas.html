<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pruebas Unitarias ‚Äî Spring Boot</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-primary: #ffffff;
    --bg-secondary: #f8f9fa;
    --bg-card: #f5f7fb;
    --bg-card-hover: #eef1f8;
    --accent-green: #059669;
    --accent-green-dim: #d1fae5;
    --accent-blue: #2563eb;
    --accent-blue-dim: #dbeafe;
    --accent-amber: #d97706;
    --accent-amber-dim: #fef3c7;
    --accent-rose: #dc2626;
    --accent-rose-dim: #fee2e2;
    --accent-purple: #7c3aed;
    --accent-purple-dim: #ede9fe;
    --text-primary: #111827;
    --text-secondary: #374151;
    --text-muted: #9ca3af;
    --border: #d1d5db;
    --code-bg: #f3f4f6;
    --glow-green: rgba(5, 150, 105, 0.1);
    --glow-blue: rgba(37, 99, 235, 0.1);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.7;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ‚îÄ */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg-primary); }
  ::-webkit-scrollbar-thumb { background: var(--text-muted); border-radius: 3px; }

  /* ‚îÄ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ */
  .hero {
    position: relative;
    padding: 80px 40px 60px;
    text-align: center;
    overflow: hidden;
  }

  .hero::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -20%;
    width: 140%;
    height: 200%;
    background: radial-gradient(ellipse at 30% 20%, var(--glow-green) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 60%, var(--glow-blue) 0%, transparent 50%);
    pointer-events: none;
    animation: heroGlow 8s ease-in-out infinite alternate;
  }

  @keyframes heroGlow {
    0% { opacity: 0.6; transform: scale(1); }
    100% { opacity: 1; transform: scale(1.05); }
  }

  .hero h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.2rem, 5vw, 3.6rem);
    font-weight: 800;
    position: relative;
    z-index: 1;
    background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 12px;
  }

  .hero .subtitle {
    font-size: 1.1rem;
    color: var(--text-secondary);
    position: relative;
    z-index: 1;
    max-width: 600px;
    margin: 0 auto;
  }

  .badge-row {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 24px;
    flex-wrap: wrap;
    position: relative;
    z-index: 1;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.3px;
  }

  .badge.spring { background: var(--accent-green-dim); color: var(--accent-green); }
  .badge.java { background: var(--accent-amber-dim); color: var(--accent-amber); }
  .badge.jpa { background: var(--accent-blue-dim); color: var(--accent-blue); }


  /* ‚îÄ‚îÄ‚îÄ Content Area ‚îÄ‚îÄ‚îÄ */
  .content-area {
    max-width: 900px;
    margin: 0 auto;
    padding: 40px 24px 80px;
  }

  .section { display: none; animation: fadeSlide 0.4s ease; }
  .section.active { display: block; }

  @keyframes fadeSlide {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ‚îÄ‚îÄ‚îÄ Section Headers ‚îÄ‚îÄ‚îÄ */
  .section-header {
    margin-bottom: 32px;
  }

  .section-header h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.9rem;
    font-weight: 700;
    margin-bottom: 8px;
  }

  .section-header p {
    color: var(--text-secondary);
    font-size: 0.95rem;
  }

  /* ‚îÄ‚îÄ‚îÄ Cards ‚îÄ‚îÄ‚îÄ */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px;
    margin-bottom: 20px;
    transition: all 0.3s;
  }

  .card:hover {
    border-color: rgba(52, 211, 153, 0.2);
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
  }

  .card h3 {
    font-size: 1.15rem;
    font-weight: 700;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .card h3 .icon {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    flex-shrink: 0;
  }

  .card p, .card li {
    color: var(--text-secondary);
    font-size: 0.92rem;
    line-height: 1.75;
  }

  .card ul {
    list-style: none;
    padding-left: 0;
    margin-top: 10px;
  }

  .card ul li {
    padding: 6px 0 6px 24px;
    position: relative;
  }

  .card ul li::before {
    content: '‚ñ∏';
    position: absolute;
    left: 4px;
    color: var(--accent-green);
    font-weight: bold;
  }

  /* ‚îÄ‚îÄ‚îÄ Code blocks ‚îÄ‚îÄ‚îÄ */
  .code-block {
    background: #1e293b;
    border: 1px solid #334155;
    border-radius: 10px;
    margin: 16px 0;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .code-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 16px;
    background: #0f172a;
    border-bottom: 1px solid #334155;
  }

  .code-header span {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: #94a3b8;
  }

  .code-dots {
    display: flex;
    gap: 6px;
  }

  .code-dots span {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .code-dots span:nth-child(1) { background: #ef4444; }
  .code-dots span:nth-child(2) { background: #fbbf24; }
  .code-dots span:nth-child(3) { background: #34d399; }

  .code-content {
    padding: 18px 20px;
    overflow-x: auto;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82rem;
    line-height: 1.7;
    background: #1e293b;
  }

  .code-content code {
    color: #e2e8f0;
    white-space: pre;
    display: block;
  }

  .kw { color: #c084fc; }
  .ann { color: #fbbf24; }
  .str { color: #6ee7b7; }
  .cls { color: #7dd3fc; }
  .cmt { color: #64748b; font-style: italic; }
  .mth { color: #f9a8d4; }
  .num { color: #fdba74; }
  .exc { color: #fb7185; }

  /* ‚îÄ‚îÄ‚îÄ Callout ‚îÄ‚îÄ‚îÄ */
  .callout {
    padding: 18px 22px;
    border-radius: 10px;
    margin: 16px 0;
    font-size: 0.88rem;
    line-height: 1.7;
  }

  .callout.info {
    background: rgba(96, 165, 250, 0.08);
    border-left: 3px solid var(--accent-blue);
    color: var(--text-secondary);
  }

  .callout.warning {
    background: rgba(251, 191, 36, 0.08);
    border-left: 3px solid var(--accent-amber);
    color: var(--text-secondary);
  }

  .callout.success {
    background: rgba(52, 211, 153, 0.08);
    border-left: 3px solid var(--accent-green);
    color: var(--text-secondary);
  }

  .callout strong { color: var(--text-primary); }

  /* ‚îÄ‚îÄ‚îÄ Highlight inline ‚îÄ‚îÄ‚îÄ */
  .hl {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.82em;
    background: rgba(167, 139, 250, 0.12);
    color: var(--accent-purple);
    padding: 2px 7px;
    border-radius: 4px;
  }

  /* ‚îÄ‚îÄ‚îÄ Step indicators ‚îÄ‚îÄ‚îÄ */
  .steps {
    counter-reset: step;
    margin: 16px 0;
  }

  .step {
    display: flex;
    gap: 16px;
    margin-bottom: 16px;
    align-items: flex-start;
  }

  .step-num {
    counter-increment: step;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--accent-green-dim);
    color: var(--accent-green);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 0.78rem;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .step-text {
    color: var(--text-secondary);
    font-size: 0.9rem;
  }

  .step-text strong { color: var(--text-primary); }

  /* ‚îÄ‚îÄ‚îÄ Footer ‚îÄ‚îÄ‚îÄ */
  .footer {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-muted);
    font-size: 0.78rem;
    border-top: 1px solid var(--border);
    margin-top: 40px;
  }

  /* ‚îÄ‚îÄ‚îÄ Test Section ‚îÄ‚îÄ‚îÄ */
  .test-scenario {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 18px 22px;
    margin: 12px 0;
  }

  .test-scenario h5 {
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .test-pass { color: var(--accent-green); }
  .test-fail { color: var(--accent-rose); }

  .test-scenario p {
    font-size: 0.82rem;
    color: var(--text-muted);
  }

  @media (max-width: 640px) {
    .hero { padding: 50px 20px 40px; }
    .content-area { padding: 24px 16px 60px; }
    .card { padding: 20px; }
    .nav-tab { padding: 8px 12px; font-size: 0.8rem; }
  }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="hero">
  <h1>Pruebas Unitarias de la L√≥gica</h1>
  <p class="subtitle">Aprende a escribir pruebas unitarias efectivas para la capa de l√≥gica de negocio en Spring Boot usando JUnit, Podam y TestEntityManager.</p>
  <div class="badge-row">
    <span class="badge spring">‚òò Spring Boot</span>
    <span class="badge java">‚ô¶ Java</span>
    <span class="badge jpa">‚óà JPA</span>
  </div>
</div>

<div class="content-area">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- SECTION 1: Pruebas                         -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="section active" id="sec-testing">
    

    <!-- Submen√∫ de Pruebas -->
    <div style="display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; justify-content: flex-start;">
      <button onclick="showTestingSubsection('config', this)" style="padding: 10px 18px; background: var(--accent-green-dim); color: var(--accent-green); border: 1px solid var(--accent-green); border-radius: 8px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 0.85rem; transition: all 0.3s;">Configuraci√≥n</button>
      <button onclick="showTestingSubsection('entitymanager', this)" style="padding: 10px 18px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 0.85rem; transition: all 0.3s;">TestEntityManager</button>
      <button onclick="showTestingSubsection('setup', this)" style="padding: 10px 18px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 0.85rem; transition: all 0.3s;">Setup</button>
      <button onclick="showTestingSubsection('podam', this)" style="padding: 10px 18px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 0.85rem; transition: all 0.3s;">Podam</button>
      <button onclick="showTestingSubsection('scenarios', this)" style="padding: 10px 18px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 0.85rem; transition: all 0.3s;">Escenarios</button>
    </div>

    <!-- Subsecci√≥n: Configuraci√≥n -->
    <div id="testing-config" class="testing-subsection" style="display: block;">

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-green-dim);color:var(--accent-green);">‚úì</span>
        Configuraci√≥n de la clase de prueba
      </h3>
      <p>Cada clase de pruebas requiere anotaciones espec√≠ficas para integrarse con el contexto de Spring y JPA.</p>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>CompanyServiceTest.java ‚Äî anotaciones</span>
        </div>
        <div class="code-content"><code><span class="ann">@ExtendWith</span>(<span class="cls">SpringExtension</span>.<span class="kw">class</span>)
<span class="ann">@DataJpaTest</span>
<span class="ann">@Transactional</span>
<span class="ann">@Import</span>(<span class="cls">CompanyService</span>.<span class="kw">class</span>)
<span class="kw">public class</span> <span class="cls">CompanyServiceTest</span>
{
&nbsp;&nbsp;<span class="ann">@Autowired</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">CompanyService</span> companyService;

&nbsp;&nbsp;<span class="ann">@Autowired</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">TestEntityManager</span> entityManager;

&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">PodamFactory</span> factory =
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">new</span> <span class="cls">PodamFactoryImpl</span>();

&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">List</span>&lt;<span class="cls">CompanyEntity</span>&gt; companyList =
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">new</span> <span class="cls">ArrayList</span>&lt;&gt;();
}</code></div>
      </div>
      <div style="margin-top: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 10px; font-size: 0.9rem; line-height: 1.7;">
        <p style="margin-bottom: 12px;"><strong>¬øQu√© hace cada anotaci√≥n?</strong></p>
        <ul style="list-style: none; padding: 0;">
          <li style="margin-bottom: 10px;"><span class="hl">@ExtendWith(SpringExtension.class)</span> ‚Äî Integra JUnit 5 con Spring para que el contexto de Spring est√© disponible durante las pruebas.</li>
          <li style="margin-bottom: 10px;"><span class="hl">@DataJpaTest</span> ‚Äî Carga solo la configuraci√≥n necesaria para pruebas de JPA. Desactiva el servidor web y carga solo las capas de BD.</li>
          <li style="margin-bottom: 10px;"><span class="hl">@Transactional</span> ‚Äî Cada prueba se ejecuta en una transacci√≥n que se revierte al terminar, dejando la BD limpia.</li>
          <li style="margin-bottom: 10px;"><span class="hl">@Import(CompanyService.class)</span> ‚Äî Importa el servicio bajo prueba al contexto de Spring para que pueda ser inyectado.</li>
          <li><span class="hl">@Autowired</span> ‚Äî Spring inyecta autom√°ticamente las dependencias marcadas (servicio, entityManager).</li>
        </ul>
      </div>
    </div>
    </div>

    <!-- Subsecci√≥n: TestEntityManager -->
    <div id="testing-entitymanager" class="testing-subsection" style="display: none;">

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-amber-dim);color:var(--accent-amber);">üóÑ</span>
        ¬øQu√© es TestEntityManager?
      </h3>
      <p>Es una herramienta proporcionada por Spring Test que permite interactuar con la base de datos de pruebas de forma manual. Se usa para:</p>
      <ul>
        <li><strong>Insertar datos de prueba:</strong> <span class="hl">entityManager.persist(entity)</span> ‚Äî Guarda datos en la BD antes de ejecutar el test.</li>
        <li><strong>Buscar datos:</strong> <span class="hl">entityManager.find(Class, id)</span> ‚Äî Obtiene una entidad de la BD para verificar que se persisti√≥ correctamente.</li>
        <li><strong>Ejecutar queries:</strong> <span class="hl">entityManager.createQuery("DELETE FROM...")</span> ‚Äî Ejecuta consultas SQL directo.</li>
        <li><strong>Limpiar datos:</strong> Elimina registros de la BD entre pruebas para garantizar aislamiento.</li>
      </ul>
      <p style="margin-top: 10px; color: var(--text-secondary);"><strong>Diferencia clave:</strong> El <span class="hl">CompanyService</span> que probamos usa <span class="hl">CompanyRepository</span> (interfaz de persistencia). El <span class="hl">TestEntityManager</span> es nuestro acceso directo a la BD para preparar datos o validar resultados sin pasar por el servicio.</p>
    </div>
    </div>

    <!-- Subsecci√≥n: Setup -->
    <div id="testing-setup" class="testing-subsection" style="display: none;">

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-purple-dim);color:var(--accent-purple);">üîÑ</span>
        ¬øQu√© es el setUp y por qu√© lo necesitamos?
      </h3>
      <p>El <strong>setUp</strong> es un m√©todo especial que se ejecuta <strong>autom√°ticamente antes de cada test</strong>. Su prop√≥sito es preparar un <strong>estado inicial conocido y consistente</strong> para que cada test comience bajo las mismas condiciones.</p>
      <p style="margin-top: 10px;"><strong>¬øPor qu√© es necesario?</strong> Sin setUp, los tests podr√≠an interferir entre s√≠:</p>
      <ul style="margin: 8px 0 0 16px; list-style: disc;">
        <li>Un test podr√≠a dejar datos en la BD que afecten al siguiente test</li>
        <li>El orden de ejecuci√≥n de los tests es impredecible (JUnit no garantiza un orden)</li>
        <li>Un test que funciona solo podr√≠a fallar cuando se ejecuta con otros</li>
      </ul>
      <p style="margin-top: 10px; color: var(--text-secondary);"><strong>Soluci√≥n:</strong> El setUp limpia la BD y carga datos frescos antes de cada test, garantizando <strong>aislamiento total</strong>.</p>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-blue-dim);color:var(--accent-blue);">‚è±</span>
        Ciclo de Vida de un Test
      </h3>
      <p>JUnit ejecuta cada test siguiendo este ciclo:</p>

      <div style="margin-top: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 10px;">
        <div class="steps">
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>@BeforeEach ‚Äî setUp():</strong> Se ejecuta ANTES de cada m√©todo <span class="hl">@Test</span>. Limpia la BD y carga datos iniciales.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>@Test ‚Äî testCreateCompany():</strong> Se ejecuta el test espec√≠fico. Usa los datos que setUp() prepar√≥.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>@AfterEach (opcional):</strong> Se ejecuta DESPU√âS del test. Generalmente no es necesario porque <span class="hl">@Transactional</span> revierte los cambios autom√°ticamente.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>Repetir:</strong> El ciclo se repite para cada m√©todo <span class="hl">@Test</span> en la clase.</div>
          </div>
        </div>
      </div>

      <div class="callout info" style="margin-top: 14px;">
        <strong>Ejemplo:</strong> Si tienes 5 m√©todos <span class="hl">@Test</span>, el setUp() se ejecutar√° <strong>5 veces</strong> (una antes de cada test). Esto garantiza que cada test empiece con la BD en el mismo estado limpio.
      </div>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-green-dim);color:var(--accent-green);">üíª</span>
        Implementaci√≥n del setUp
      </h3>
      <p>El m√©todo setUp t√≠picamente hace dos cosas: <strong>limpiar</strong> la BD y luego <strong>insertar</strong> datos de prueba.</p>

      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>CompanyServiceTest.java ‚Äî setUp completo</span>
        </div>
        <div class="code-content"><code><span class="ann">@BeforeEach</span>
<span class="kw">void</span> <span class="mth">setUp</span>()
{
&nbsp;&nbsp;<span class="cmt">// 1. Limpiar todos los datos existentes</span>
&nbsp;&nbsp;<span class="mth">clearData</span>();
&nbsp;&nbsp;
&nbsp;&nbsp;<span class="cmt">// 2. Insertar datos frescos para las pruebas</span>
&nbsp;&nbsp;<span class="mth">insertData</span>();
}

<span class="cmt">// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="cmt">// M√©todo auxiliar: Limpiar la base de datos</span>
<span class="cmt">// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="kw">private void</span> <span class="mth">clearData</span>()
{
&nbsp;&nbsp;entityManager.<span class="mth">getEntityManager</span>()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<span class="mth">createQuery</span>(<span class="str">"delete from CompanyEntity"</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<span class="mth">executeUpdate</span>();
}

<span class="cmt">// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="cmt">// M√©todo auxiliar: Insertar datos de prueba</span>
<span class="cmt">// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span>
<span class="kw">private void</span> <span class="mth">insertData</span>()
{
&nbsp;&nbsp;<span class="kw">for</span> (<span class="kw">int</span> i = <span class="num">0</span>; i < <span class="num">3</span>; i++)
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cls">CompanyEntity</span> entity =
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory.<span class="mth">manufacturePojo</span>(<span class="cls">CompanyEntity</span>.<span class="kw">class</span>);
&nbsp;&nbsp;&nbsp;&nbsp;entityManager.<span class="mth">persist</span>(entity);
&nbsp;&nbsp;&nbsp;&nbsp;companyList.<span class="mth">add</span>(entity);
&nbsp;&nbsp;}
}</code></div>
      </div>

      <div style="margin-top: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 10px; font-size: 0.9rem; line-height: 1.7;">
        <p style="margin-bottom: 12px;"><strong>Desglose paso a paso:</strong></p>

        <p style="font-weight: 600; color: var(--accent-green); margin-top: 14px;">üìå clearData() ‚Äî Limpieza de la BD</p>
        <div class="steps">
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><span class="hl">entityManager.getEntityManager()</span> ‚Äî Obtiene el EntityManager de JPA que maneja la conexi√≥n a la BD de pruebas (H2 en memoria).</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><span class="hl">.createQuery("delete from CompanyEntity")</span> ‚Äî Crea una query JPQL (no SQL nativo) que elimina TODAS las filas de la tabla CompanyEntity.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><span class="hl">.executeUpdate()</span> ‚Äî Ejecuta la query de eliminaci√≥n. Retorna el n√∫mero de filas eliminadas (pero no lo usamos).</div>
          </div>
        </div>

        <p style="font-weight: 600; color: var(--accent-blue); margin-top: 20px;">üìå insertData() ‚Äî Carga de datos de prueba</p>
        <div class="steps">
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><span class="hl">for (int i = 0; i < 3; i++)</span> ‚Äî Inserta exactamente <strong>3 compa√±√≠as</strong>. ¬øPor qu√© 3? Para tener suficientes datos para tests negativos (ej: intentar crear una con nombre duplicado).</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><span class="hl">factory.manufacturePojo(...)</span> ‚Äî Usa Podam para generar una CompanyEntity con datos aleatorios v√°lidos (nombre, descripci√≥n, etc.).</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><span class="hl">entityManager.persist(entity)</span> ‚Äî Guarda la compa√±√≠a en la base de datos de pruebas usando TestEntityManager.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><span class="hl">companyList.add(entity)</span> ‚Äî Guarda la compa√±√≠a en una lista en memoria (<span class="hl">companyList</span> es una variable de instancia de la clase de test). Esto permite que los tests accedan f√°cilmente a las compa√±√≠as existentes.</div>
          </div>
        </div>
      </div>

      <div class="callout success" style="margin-top: 14px;">
        <strong>Variable companyList:</strong> Es una <span class="hl">List&lt;CompanyEntity&gt;</span> declarada en la clase de test. Despu√©s del setUp(), contiene las 3 compa√±√≠as que acabamos de insertar. Los tests pueden usar <span class="hl">companyList.get(0)</span> para acceder a una compa√±√≠a existente (ej: para tests de nombre duplicado).
      </div>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-amber-dim);color:var(--accent-amber);">‚ùì</span>
        Preguntas Frecuentes
      </h3>

      <div style="margin-top: 14px; padding: 14px; background: rgba(96, 165, 250, 0.08); border-left: 3px solid #3b82f6; font-size: 0.88rem; line-height: 1.7; color: var(--text-secondary);">
        <strong>¬øEs necesario clearData() si @Transactional revierte los cambios?</strong>
        <p style="margin: 8px 0 0 0;">Buena pregunta. T√©cnicamente, cada test se revierte autom√°ticamente por <span class="hl">@Transactional</span> (la BD vuelve al estado previo despu√©s de cada test). Sin embargo, <span class="hl">clearData()</span> sigue siendo importante porque:</p>
        <ul style="margin: 8px 0 0 16px; list-style: disc;">
          <li>Garantiza un <strong>estado limpio expl√≠cito</strong> al inicio de cada test</li>
          <li>Protege contra cambios futuros en la configuraci√≥n transaccional</li>
          <li>Hace visible la intenci√≥n: "empezar con BD vac√≠a"</li>
          <li>Si usas datos desde <span class="hl">data.sql</span> u otros or√≠genes, asegura que se limpien correctamente</li>
        </ul>
        <p style="margin: 8px 0 0 0;"><strong>En resumen:</strong> No es estrictamente necesario t√©cnicamente, pero es una <strong>buena pr√°ctica</strong> de limpieza expl√≠cita que hace los tests m√°s robustos y f√°ciles de entender.</p>
      </div>

      <div style="margin-top: 14px; padding: 14px; background: rgba(251, 191, 36, 0.08); border-left: 3px solid #d97706; font-size: 0.88rem; line-height: 1.7; color: var(--text-secondary);">
        <strong>¬øPor qu√© insertamos 3 compa√±√≠as y no solo 1?</strong>
        <p style="margin: 8px 0 0 0;">Insertar m√∫ltiples registros (t√≠picamente 3-5) es √∫til porque:</p>
        <ul style="margin: 8px 0 0 16px; list-style: disc;">
          <li><strong>Tests de b√∫squeda:</strong> Puedes verificar que findAll() retorna todos los elementos</li>
          <li><strong>Tests de filtrado:</strong> Puedes buscar uno espec√≠fico entre varios</li>
          <li><strong>Tests negativos:</strong> Necesitas datos existentes para probar duplicados o violaciones de unicidad</li>
          <li><strong>Realismo:</strong> Una BD con varios registros es m√°s representativo del mundo real</li>
        </ul>
        <p style="margin: 8px 0 0 0;"><strong>Regla pr√°ctica:</strong> Inserta entre 3 y 5 elementos. No demasiados (lentitud) ni muy pocos (tests poco realistas).</p>
      </div>

      <div style="margin-top: 14px; padding: 14px; background: rgba(124, 58, 237, 0.08); border-left: 3px solid #7c3aed; font-size: 0.88rem; line-height: 1.7; color: var(--text-secondary);">
        <strong>¬øD√≥nde se declara companyList?</strong>
        <p style="margin: 8px 0 0 0;">La variable <span class="hl">companyList</span> se declara como variable de instancia en la clase de test:</p>
        <div class="code-block" style="margin: 10px 0 0 0;">
          <div class="code-header">
            <div class="code-dots"><span></span><span></span><span></span></div>
            <span>Variables de instancia en CompanyServiceTest</span>
          </div>
          <div class="code-content"><code><span class="kw">public class</span> <span class="cls">CompanyServiceTest</span>
{
&nbsp;&nbsp;<span class="ann">@Autowired</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">CompanyService</span> companyService;

&nbsp;&nbsp;<span class="ann">@Autowired</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">TestEntityManager</span> entityManager;

&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">PodamFactory</span> factory =
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">new</span> <span class="cls">PodamFactoryImpl</span>();

&nbsp;&nbsp;<span class="cmt">// Lista que almacena las compa√±√≠as insertadas en setUp()</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">List</span>&lt;<span class="cls">CompanyEntity</span>&gt; companyList =
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">new</span> <span class="cls">ArrayList</span>&lt;&gt;();
}</code></div>
        </div>
        <p style="margin: 8px 0 0 0;">Esta lista se <strong>limpia autom√°ticamente</strong> en cada setUp() porque se crea como <span class="hl">new ArrayList&lt;&gt;()</span>, pero puedes tambi√©n hacer <span class="hl">companyList.clear()</span> al inicio de insertData() para ser m√°s expl√≠cito.</p>
      </div>
    </div>

    <div class="callout info">
      <strong>Resumen:</strong> El setUp() con <span class="hl">@BeforeEach</span> garantiza que cada test empiece con un <strong>estado conocido y consistente</strong>. Limpia la BD (<span class="hl">clearData()</span>), inserta datos frescos (<span class="hl">insertData()</span>), y permite que los tests sean <strong>independientes</strong> y <strong>repetibles</strong>. Esto es fundamental para tener pruebas confiables que no dependan del orden de ejecuci√≥n.
    </div>
    </div>

    <!-- Subsecci√≥n: Podam -->
    <div id="testing-podam" class="testing-subsection" style="display: none;">

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-purple-dim);color:var(--accent-purple);">‚öô</span>
        ¬øQu√© es Podam?
      </h3>
      <p><span class="hl">Podam</span> (POjo DAta Maker) es una librer√≠a Java que genera autom√°ticamente instancias de clases con datos aleatorios v√°lidos. Es especialmente √∫til en pruebas unitarias porque elimina la necesidad de crear manualmente objetos de prueba con todos sus atributos.</p>
      <p style="margin-top: 10px;"><strong>¬øC√≥mo funciona?</strong> Podam usa reflexi√≥n para inspeccionar la clase, identificar sus atributos (String, Long, Date, etc.) y generar valores aleatorios apropiados para cada tipo.</p>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-green-dim);color:var(--accent-green);">‚úì</span>
        Ejemplo Simple ‚Äî Generar una entidad
      </h3>
      <p>Supongamos que tienes esta entidad:</p>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>BookEntity.java</span>
        </div>
        <div class="code-content"><code><span class="ann">@Entity</span>
<span class="kw">public class</span> <span class="cls">BookEntity</span>
{
&nbsp;&nbsp;<span class="ann">@Id</span>
&nbsp;&nbsp;<span class="ann">@GeneratedValue</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">Long</span> id;

&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">String</span> name;
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">String</span> isbn;
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">Date</span> publishDate;
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">Integer</span> pages;

&nbsp;&nbsp;<span class="cmt">// getters y setters...</span>
}</code></div>
      </div>

      <p style="margin-top: 14px;">En lugar de crear manualmente el objeto as√≠:</p>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>‚ùå Forma manual (tedioso y repetitivo)</span>
        </div>
        <div class="code-content"><code><span class="cls">BookEntity</span> book = <span class="kw">new</span> <span class="cls">BookEntity</span>();
book.<span class="mth">setName</span>(<span class="str">"El Quijote"</span>);
book.<span class="mth">setIsbn</span>(<span class="str">"978-1234567890"</span>);
book.<span class="mth">setPublishDate</span>(<span class="kw">new</span> <span class="cls">Date</span>());
book.<span class="mth">setPages</span>(<span class="num">863</span>);
<span class="cmt">// Repetir esto para cada test...</span></code></div>
      </div>

      <p style="margin-top: 14px;">Con Podam, lo haces en una l√≠nea:</p>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>‚úÖ Con Podam (autom√°tico)</span>
        </div>
        <div class="code-content"><code><span class="cls">PodamFactory</span> factory = <span class="kw">new</span> <span class="cls">PodamFactoryImpl</span>();
<span class="cls">BookEntity</span> book = factory.<span class="mth">manufacturePojo</span>(<span class="cls">BookEntity</span>.<span class="kw">class</span>);

<span class="cmt">// book ya tiene todos los campos inicializados con valores aleatorios</span>
<span class="cmt">// name = "alg√∫n texto aleatorio"</span>
<span class="cmt">// isbn = "otro texto aleatorio"</span>
<span class="cmt">// publishDate = alguna fecha aleatoria</span>
<span class="cmt">// pages = alg√∫n n√∫mero aleatorio</span></code></div>
      </div>

      <div class="callout success">
        <strong>Ventaja:</strong> Cada vez que ejecutas el test, Podam genera datos diferentes. Esto prueba que tu c√≥digo funciona con diversos valores, no solo con datos espec√≠ficos hardcodeados.
      </div>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-rose-dim);color:var(--accent-rose);">‚ö†</span>
        Problema: Loop Infinito con Relaciones Bidireccionales
      </h3>
      <p>Cuando tienes entidades con relaciones bidireccionales (donde A conoce a B y B conoce a A), Podam puede entrar en un <strong>loop infinito</strong> al intentar generar los objetos.</p>

      <p style="margin-top: 14px;"><strong>Ejemplo del problema:</strong></p>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>BookEntity.java ‚Äî con relaci√≥n bidireccional</span>
        </div>
        <div class="code-content"><code><span class="ann">@Entity</span>
<span class="kw">public class</span> <span class="cls">BookEntity</span>
{
&nbsp;&nbsp;<span class="ann">@Id</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">Long</span> id;
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">String</span> name;

&nbsp;&nbsp;<span class="cmt">// Relaci√≥n: un libro tiene un autor</span>
&nbsp;&nbsp;<span class="ann">@ManyToOne</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">AuthorEntity</span> author;
}</code></div>
      </div>

      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>AuthorEntity.java ‚Äî relaci√≥n inversa</span>
        </div>
        <div class="code-content"><code><span class="ann">@Entity</span>
<span class="kw">public class</span> <span class="cls">AuthorEntity</span>
{
&nbsp;&nbsp;<span class="ann">@Id</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">Long</span> id;
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">String</span> name;

&nbsp;&nbsp;<span class="cmt">// Relaci√≥n inversa: un autor tiene muchos libros</span>
&nbsp;&nbsp;<span class="ann">@OneToMany</span>(mappedBy = <span class="str">"author"</span>)
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">List</span>&lt;<span class="cls">BookEntity</span>&gt; books;
}</code></div>
      </div>

      <div class="callout warning" style="margin-top: 14px;">
        <strong>¬øQu√© pasa si intentas generar un BookEntity con Podam?</strong>
        <ol style="margin: 8px 0 0 20px;">
          <li>Podam crea un <span class="hl">BookEntity</span></li>
          <li>Ve que tiene un atributo <span class="hl">author</span>, as√≠ que crea un <span class="hl">AuthorEntity</span></li>
          <li>Ve que <span class="hl">AuthorEntity</span> tiene una lista <span class="hl">books</span>, as√≠ que crea libros</li>
          <li>Cada libro necesita un <span class="hl">author</span>, as√≠ que crea m√°s autores</li>
          <li>Cada autor tiene <span class="hl">books</span>, as√≠ que crea m√°s libros...</li>
          <li><strong>Loop infinito ‚Üí StackOverflowError</strong> üí•</li>
        </ol>
      </div>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-blue-dim);color:var(--accent-blue);">üîß</span>
        Soluci√≥n: @PodamExclude
      </h3>
      <p>La anotaci√≥n <span class="hl">@PodamExclude</span> le indica a Podam que <strong>ignore ese atributo</strong> y no intente generar datos para √©l. Se coloca sobre el atributo que queremos excluir (t√≠picamente el lado inverso de la relaci√≥n).</p>

      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>AuthorEntity.java ‚Äî con @PodamExclude</span>
        </div>
        <div class="code-content"><code><span class="kw">import</span> uk.co.jemos.podam.common.<span class="cls">PodamExclude</span>;

<span class="ann">@Entity</span>
<span class="kw">public class</span> <span class="cls">AuthorEntity</span>
{
&nbsp;&nbsp;<span class="ann">@Id</span>
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">Long</span> id;
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">String</span> name;
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">Date</span> birthDate;

&nbsp;&nbsp;<span class="cmt">// ‚úÖ Excluir esta colecci√≥n para evitar loop infinito</span>
&nbsp;&nbsp;<span class="ann">@PodamExclude</span>
&nbsp;&nbsp;<span class="ann">@OneToMany</span>(mappedBy = <span class="str">"author"</span>)
&nbsp;&nbsp;<span class="kw">private</span> <span class="cls">List</span>&lt;<span class="cls">BookEntity</span>&gt; books;

&nbsp;&nbsp;<span class="cmt">// getters y setters...</span>
}</code></div>
      </div>

      <p style="margin-top: 14px;">Ahora al generar un <span class="hl">BookEntity</span>:</p>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>Uso en pruebas</span>
        </div>
        <div class="code-content"><code><span class="cls">PodamFactory</span> factory = <span class="kw">new</span> <span class="cls">PodamFactoryImpl</span>();
<span class="cls">BookEntity</span> book = factory.<span class="mth">manufacturePojo</span>(<span class="cls">BookEntity</span>.<span class="kw">class</span>);

<span class="cmt">// ‚úÖ book tiene:</span>
<span class="cmt">//   - id, name, isbn, publishDate ‚Üí valores aleatorios</span>
<span class="cmt">//   - author ‚Üí un AuthorEntity con id, name, birthDate aleatorios</span>
<span class="cmt">//   - author.books ‚Üí null (porque est√° excluido con @PodamExclude)</span>

<span class="cmt">// ‚úÖ No hay loop infinito</span></code></div>
      </div>

      <div class="callout info" style="margin-top: 14px;">
        <strong>Regla pr√°ctica:</strong> En relaciones bidireccionales, agrega <span class="hl">@PodamExclude</span> al lado que tiene la colecci√≥n (<span class="hl">@OneToMany</span> o <span class="hl">@ManyToMany</span>). As√≠ Podam puede generar el lado "muchos" sin problemas, pero no intenta llenar la colecci√≥n del lado "uno".
      </div>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-amber-dim);color:var(--accent-amber);">üìã</span>
        Buenas Pr√°cticas con Podam
      </h3>
      <ul>
        <li><strong>Usa @PodamExclude en colecciones de relaciones inversas:</strong> Evita loops infinitos en relaciones bidireccionales.</li>
        <li><strong>Declara el factory como variable de instancia:</strong> <span class="hl">private PodamFactory factory = new PodamFactoryImpl();</span> para reutilizarlo en todos los tests.</li>
        <li><strong>Modifica solo lo necesario:</strong> Genera el objeto con Podam y luego sobrescribe solo los atributos espec√≠ficos que necesites para el test (ej: <span class="hl">book.setIsbn("specific-value")</span>).</li>
        <li><strong>No conf√≠es en valores espec√≠ficos:</strong> Como Podam genera datos aleatorios, no hagas aserciones sobre valores concretos (ej: no asumas que <span class="hl">name</span> ser√° "algo espec√≠fico"). En su lugar, verifica que el objeto exista y tenga la estructura correcta.</li>
      </ul>
    </div>

    <div class="callout success">
      <strong>Resumen:</strong> Podam ahorra tiempo al generar objetos de prueba autom√°ticamente. Cuando trabajas con entidades relacionadas, usa <span class="hl">@PodamExclude</span> en las colecciones inversas para evitar loops infinitos. Esto es especialmente importante en arquitecturas con m√∫ltiples entidades interconectadas como las que usamos en Spring Boot con JPA.
    </div>
    </div>

    <!-- Subsecci√≥n: Escenarios -->
    <div id="testing-scenarios" class="testing-subsection" style="display: none;">

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-purple-dim);color:var(--accent-purple);">üìù</span>
        ¬øQu√© son los Escenarios de Prueba?
      </h3>
      <p>Los <strong>escenarios de prueba</strong> son casos de uso espec√≠ficos que verifican que tu c√≥digo se comporta correctamente. Cada escenario es un m√©todo anotado con <span class="hl">@Test</span> que ejecuta el servicio bajo condiciones espec√≠ficas y valida el resultado.</p>
      <p style="margin-top: 10px;">Hay dos tipos principales de escenarios:</p>
      <ul style="margin: 8px 0 0 16px; list-style: disc;">
        <li><strong>Escenarios positivos (caso feliz):</strong> Verifican que el c√≥digo funciona cuando todo est√° correcto.</li>
        <li><strong>Escenarios negativos:</strong> Verifican que el c√≥digo maneja correctamente los errores y violaciones de reglas de negocio.</li>
      </ul>
      <p style="margin-top: 10px; color: var(--text-secondary);">Por cada m√©todo del servicio necesitas <strong>al menos un test positivo</strong> y <strong>un test negativo por cada regla de negocio</strong>. Si <span class="hl">createCompany()</span> valida 2 reglas, necesitas 1 positivo + 2 negativos = <strong>3 tests m√≠nimo</strong>.</p>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-green-dim);color:var(--accent-green);">‚úì</span>
        Escenario Positivo ‚Äî Crear compa√±√≠a v√°lida
      </h3>
      <p>Este test verifica que el m√©todo <span class="hl">createCompany()</span> funciona correctamente cuando se proporciona una compa√±√≠a v√°lida (sin violaciones de reglas).</p>

      <div class="code-block" style="margin-top:14px;">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>CompanyServiceTest.java ‚Äî testCreateCompany()</span>
        </div>
        <div class="code-content"><code><span class="ann">@Test</span>
<span class="kw">void</span> <span class="mth">testCreateCompany</span>()
{
&nbsp;&nbsp;<span class="cmt">// Paso 1: Generar datos de prueba</span>
&nbsp;&nbsp;<span class="cls">CompanyEntity</span> newEntity =
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory.<span class="mth">manufacturePojo</span>(<span class="cls">CompanyEntity</span>.<span class="kw">class</span>);

&nbsp;&nbsp;<span class="cmt">// Paso 2: Invocar el m√©todo bajo prueba</span>
&nbsp;&nbsp;<span class="cls">CompanyEntity</span> result =
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;companyService.<span class="mth">createCompany</span>(newEntity);

&nbsp;&nbsp;<span class="cmt">// Paso 3: Verificar que retorn√≥ un resultado</span>
&nbsp;&nbsp;<span class="mth">assertNotNull</span>(result);

&nbsp;&nbsp;<span class="cmt">// Paso 4: Buscar en BD usando TestEntityManager</span>
&nbsp;&nbsp;<span class="cls">CompanyEntity</span> entity = entityManager
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.<span class="mth">find</span>(<span class="cls">CompanyEntity</span>.<span class="kw">class</span>, result.<span class="mth">getId</span>());

&nbsp;&nbsp;<span class="cmt">// Paso 5: Verificar que se persisti√≥ correctamente</span>
&nbsp;&nbsp;<span class="mth">assertEquals</span>(newEntity.<span class="mth">getName</span>(), entity.<span class="mth">getName</span>());
&nbsp;&nbsp;<span class="mth">assertEquals</span>(newEntity.<span class="mth">getDescription</span>(),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entity.<span class="mth">getDescription</span>());
}</code></div>
      </div>

      <div style="margin-top: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 10px; font-size: 0.9rem; line-height: 1.7;">
        <p style="margin-bottom: 12px;"><strong>Desglose paso a paso:</strong></p>
        <div class="steps">
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>Generar datos de prueba:</strong> Usamos Podam para crear una <span class="hl">CompanyEntity</span> con datos aleatorios v√°lidos. Esto simula una compa√±√≠a nueva que queremos guardar.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>Invocar el servicio:</strong> Llamamos al m√©todo <span class="hl">companyService.createCompany(newEntity)</span> que es el c√≥digo que estamos probando. Este m√©todo deber√≠a validar las reglas y guardar la compa√±√≠a en la base de datos.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>Verificar que no retorna null:</strong> <span class="hl">assertNotNull(result)</span> confirma que el m√©todo retorn√≥ algo (no null). Si retorna null, el test falla inmediatamente.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>Buscar en BD independientemente:</strong> Usamos <span class="hl">entityManager.find()</span> para buscar la compa√±√≠a directamente en la base de datos. <strong>No usamos el servicio</strong> porque queremos verificar que realmente se persisti√≥, no solo que el m√©todo retorn√≥ algo.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>Validar los datos:</strong> <span class="hl">assertEquals()</span> compara los valores originales con los que est√°n en la BD. Si coinciden, significa que la compa√±√≠a se guard√≥ correctamente con todos sus datos intactos.</div>
          </div>
        </div>
      </div>

      <div class="callout success" style="margin-top: 14px;">
        <strong>Concepto clave:</strong> Siempre verifica la persistencia usando <span class="hl">TestEntityManager</span>, no llamando de nuevo al servicio. Esto asegura que realmente se guard√≥ en la base de datos, no solo que el servicio dice que lo hizo.
      </div>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-rose-dim);color:var(--accent-rose);">‚úó</span>
        Escenario Negativo ‚Äî Nombre duplicado
      </h3>
      <p>Este test verifica que el m√©todo <span class="hl">createCompany()</span> <strong>rechaza correctamente</strong> una compa√±√≠a cuando se viola la regla de negocio "no puede haber dos compa√±√≠as con el mismo nombre".</p>

      <div class="code-block" style="margin-top:14px;">
        <div class="code-header">
          <div class="code-dots"><span></span><span></span><span></span></div>
          <span>CompanyServiceTest.java ‚Äî testCreateInvalidCompany()</span>
        </div>
        <div class="code-content"><code><span class="ann">@Test</span>
<span class="kw">void</span> <span class="mth">testCreateInvalidCompany</span>()
{
&nbsp;&nbsp;<span class="cmt">// assertThrows: verifica que el c√≥digo lanza una excepci√≥n</span>
&nbsp;&nbsp;<span class="mth">assertThrows</span>(<span class="exc">IllegalOperationException</span>.<span class="kw">class</span>, () ->
&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// Paso 1: Generar una compa√±√≠a nueva</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cls">CompanyEntity</span> newEntity =
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory.<span class="mth">manufacturePojo</span>(<span class="cls">CompanyEntity</span>.<span class="kw">class</span>);

&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// Paso 2: Cambiar el nombre para que sea igual a una existente</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// companyList tiene datos cargados en setUp()</span>
&nbsp;&nbsp;&nbsp;&nbsp;newEntity.<span class="mth">setName</span>(companyList.<span class="mth">get</span>(<span class="num">0</span>).<span class="mth">getName</span>());

&nbsp;&nbsp;&nbsp;&nbsp;<span class="cmt">// Paso 3: Intentar crear (deber√≠a fallar)</span>
&nbsp;&nbsp;&nbsp;&nbsp;companyService.<span class="mth">createCompany</span>(newEntity);
&nbsp;&nbsp;});
}</code></div>
      </div>

      <div style="margin-top: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 10px; font-size: 0.9rem; line-height: 1.7;">
        <p style="margin-bottom: 12px;"><strong>Desglose paso a paso:</strong></p>
        <div class="steps">
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>assertThrows:</strong> Esta aserci√≥n especial de JUnit 5 ejecuta el c√≥digo dentro del lambda <span class="hl">() -> {...}</span> y <strong>verifica que lance la excepci√≥n indicada</strong>. Si el c√≥digo NO lanza la excepci√≥n, el test falla.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>Generar datos base:</strong> Creamos una compa√±√≠a con Podam, pero luego modificaremos su nombre para violar la regla de negocio.</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>Forzar la violaci√≥n:</strong> Cambiamos el nombre de la nueva compa√±√≠a para que sea igual al de una existente (que fue cargada en <span class="hl">setUp()</span>). Esto <strong>garantiza que se viole la regla</strong> "nombres √∫nicos".</div>
          </div>
          <div class="step">
            <div class="step-num"></div>
            <div class="step-text"><strong>Invocar y esperar fallo:</strong> Llamamos a <span class="hl">createCompany()</span>. El servicio deber√≠a detectar el nombre duplicado y lanzar <span class="hl">IllegalOperationException</span>. Si lanza la excepci√≥n, el test pasa ‚úì. Si NO lanza excepci√≥n, el test falla ‚úó.</div>
          </div>
        </div>
      </div>

      <div class="callout warning" style="margin-top: 14px;">
        <strong>Importante:</strong> En escenarios negativos, <strong>el √©xito del test significa que el c√≥digo fall√≥ correctamente</strong>. Es decir, queremos que lance la excepci√≥n. Si el c√≥digo permite la operaci√≥n inv√°lida, entonces el test falla porque el servicio no est√° validando bien.
      </div>
    </div>

    <div class="card">
      <h3>
        <span class="icon" style="background:var(--accent-blue-dim);color:var(--accent-blue);">üìä</span>
        Estrategia General de Pruebas
      </h3>
      <p>Para cada m√©todo del servicio, sigue esta estrategia:</p>

      <div style="margin-top: 14px; padding: 16px; background: var(--bg-secondary); border-radius: 10px;">
        <p style="font-weight: 600; margin-bottom: 10px;">1. Identifica qu√© pruebas necesitas:</p>
        <ul style="margin: 0 0 16px 20px; list-style: disc; line-height: 1.8;">
          <li><strong>1 test positivo</strong> que verifique el caso feliz (todo funciona bien)</li>
          <li><strong>1 test negativo por cada regla de negocio</strong> que el m√©todo valide</li>
        </ul>

        <p style="font-weight: 600; margin-bottom: 10px;">2. Ejemplo con <span class="hl">createBook()</span>:</p>
        <ul style="margin: 0 0 16px 20px; list-style: disc; line-height: 1.8;">
          <li>Regla 1: El ISBN no puede ser vac√≠o</li>
          <li>Regla 2: La fecha de publicaci√≥n debe ser posterior al nacimiento del autor</li>
          <li><strong>Tests necesarios:</strong> 1 positivo + 2 negativos = <strong>3 tests</strong></li>
        </ul>

        <p style="font-weight: 600; margin-bottom: 10px;">3. Nombres descriptivos:</p>
        <ul style="margin: 0 0 0 20px; list-style: disc; line-height: 1.8;">
          <li><span class="hl">testCreateBook()</span> ‚Äî caso feliz</li>
          <li><span class="hl">testCreateBookWithEmptyIsbn()</span> ‚Äî valida regla 1</li>
          <li><span class="hl">testCreateBookWithInvalidPublishDate()</span> ‚Äî valida regla 2</li>
        </ul>
      </div>

      <div class="test-scenario" style="margin-top: 16px;">
        <h5 style="font-size: 0.9rem; font-weight: 600; color: var(--accent-purple); margin-bottom: 8px;">üí° Tabla de cobertura de pruebas</h5>
        <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
          <thead>
            <tr style="background: var(--bg-secondary);">
              <th style="padding: 10px; text-align: left; border: 1px solid var(--border);">M√©todo del Servicio</th>
              <th style="padding: 10px; text-align: center; border: 1px solid var(--border);">Reglas de Negocio</th>
              <th style="padding: 10px; text-align: center; border: 1px solid var(--border);">Tests Positivos</th>
              <th style="padding: 10px; text-align: center; border: 1px solid var(--border);">Tests Negativos</th>
              <th style="padding: 10px; text-align: center; border: 1px solid var(--border);">Total Tests</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding: 10px; border: 1px solid var(--border);"><span class="hl">createCompany()</span></td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border);">1</td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border);">1</td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border);">1</td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border); font-weight: 700;">2</td>
            </tr>
            <tr style="background: var(--bg-secondary);">
              <td style="padding: 10px; border: 1px solid var(--border);"><span class="hl">createBook()</span></td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border);">2</td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border);">1</td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border);">2</td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border); font-weight: 700;">3</td>
            </tr>
            <tr>
              <td style="padding: 10px; border: 1px solid var(--border);"><span class="hl">createDepartment()</span></td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border);">1</td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border);">1</td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border);">1</td>
              <td style="padding: 10px; text-align: center; border: 1px solid var(--border); font-weight: 700;">2</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="callout success">
      <strong>Resumen:</strong> Los escenarios de prueba verifican que tu servicio funciona correctamente (positivo) y rechaza operaciones inv√°lidas (negativo). Cada test sigue el patr√≥n: <strong>preparar datos ‚Üí ejecutar ‚Üí validar resultado</strong>. Usa Podam para datos aleatorios, TestEntityManager para verificar persistencia, y assertThrows para validar que las excepciones se lanzan cuando deben.
    </div>
    </div>
    </div>

</div>

<div class="footer">
  Curso de Desarrollo de Software ‚Äî Pruebas Unitarias con Spring Boot
</div>

<script>
  // ‚îÄ‚îÄ‚îÄ Testing Subsections ‚îÄ‚îÄ‚îÄ
  function showTestingSubsection(subsection, btn) {
    console.log('Mostrando subsecci√≥n:', subsection);
    console.log('ID buscado:', 'testing-' + subsection);

    // Ocultar todas las subsecciones
    document.querySelectorAll('.testing-subsection').forEach(s => s.style.display = 'none');

    // Mostrar la subsecci√≥n seleccionada
    const targetElement = document.getElementById('testing-' + subsection);
    console.log('Elemento encontrado:', targetElement);

    if (targetElement) {
      targetElement.style.display = 'block';
      console.log('Display cambiado a block');
    } else {
      console.error('No se encontr√≥ el elemento con ID: testing-' + subsection);
      return;
    }

    // Cambiar estilos de botones
    document.querySelectorAll('[onclick*="showTestingSubsection"]').forEach(button => {
      button.style.background = 'transparent';
      button.style.color = 'var(--text-secondary)';
      button.style.borderColor = 'var(--border)';
    });

    if (btn) {
      btn.style.background = 'var(--accent-green-dim)';
      btn.style.color = 'var(--accent-green)';
      btn.style.borderColor = 'var(--accent-green)';
    }
  }
</script>
</body>
</html>